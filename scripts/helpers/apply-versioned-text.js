const AUTOGENERATED_VERSION_REGEX =
    /(?<preVersionText><!-- AUTOGENERATED VERSION START -->.*?)v\d+\.\d+\.\d+(?<postVersionText>.*?<!-- AUTOGENERATED END -->)/g

function applyVersionedText(text, packageJson) {
    const version = JSON.parse(packageJson).version
    const hasPartsToUpdate = !version || AUTOGENERATED_VERSION_REGEX.test(text)

    const updatedText = text.replace(
        AUTOGENERATED_VERSION_REGEX,
        `$<preVersionText>v${version}$<postVersionText>`
    )

    return {
        hasPartsToUpdate,
        updatedText,
    }
}

module.exports = { applyVersionedText }
